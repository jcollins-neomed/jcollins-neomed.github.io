<title>Jason's Lottery Helper Tool</title>

<body>
  <select id="dropdown">
    <option value="">--Choose City--</option>
    <option value="Akron">Akron</option>
    <option value="Cleveland">Cleveland</option>
    <option value="Youngstown">Youngstown</option>
    <option value="Columbus">Columbus</option>
  </select>
  <button id="searchBtn">Search</button>
  <div id="result"></div>

<div id="result"></div>

<!-- PapaParse for CSV parsing -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
  table {
    border-collapse: collapse;
    margin-top: 1em;
    width: 100%;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 4px 6px;
    text-align: center;
    vertical-align: top;
  }
  th {
    background: #f2f2f2;
  }
  .rotation {
    display: block;
    padding: 2px 6px;
    margin-bottom: 2px;
    border-radius: 4px;
    color: #fff;
    font-size: 0.85em;
  }
  .site {
    font-size: 0.8em;
    color: #555;
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const dropdown = document.getElementById('dropdown');
  const searchBtn = document.getElementById('searchBtn');
  const resultDiv = document.getElementById('result');

  // Colors for specialties
  const specialtyColors = {
    'Surgery Clerkship': '#9C27B0',
    'Obstetric/Gynecology Clerkship': '#E91E63',
    'Free': '#9E9E9E',
    'Family Medicine Clerkship': '#4CAF50',
    'Psychiatry Clerkship': '#795548',
    'Internal Medicine Clerkship': '#2196F3',
    'Emergency Medicine Clerkship': '#3F51B5',
    'Pediatrics Clerkship': '#FF9800'
  };

  function getColor(spec) {
    return specialtyColors[spec] || '#607D8B';
  }

  async function searchCSV() {
    const choice = dropdown.value.trim();
    if (!choice) {
      resultDiv.textContent = 'Please select a city.';
      return;
    }

    try {
      const response = await fetch('schedules.csv');
      const text = await response.text();
      const parsed = Papa.parse(text, { header: true });

      // Filter rows by Dominant City
      const matches = parsed.data.filter(row => row['Dominant City'] === choice);

      if (!matches.length) {
        resultDiv.textContent = 'No matches found.';
        return;
      }

      // Table header for 9 blocks
      const headers = Array.from({ length: 9 }, (_, i) => `<th>Block ${i+1}</th>`).join('');
      let tableHTML = `<table><thead><tr><th>Schedule</th>${headers}</tr></thead><tbody>`;

      matches.forEach((row, idx) => {
        const blocks = [];
        for (let i = 1; i <= 9; i++) {
          const rotation = row[`Block ${i} Rotation`] || '';
          const site = row[`Block ${i} Site`] || ''; // if you store hospital/site separately
          const color = getColor(rotation.trim());
          blocks.push(
            `<td>
               <span class="rotation" style="background-color:${color}">${rotation}</span>
               <div class="site">${site}</div>
             </td>`
          );
        }
        tableHTML += `<tr><td>${idx + 1}</td>${blocks.join('')}</tr>`;
      });

      tableHTML += '</tbody></table>';
      resultDiv.innerHTML = `<strong>Results:</strong><br>${tableHTML}`;
    } catch (err) {
      console.error(err);
      resultDiv.textContent = 'Error reading CSV file.';
    }
  }

  searchBtn.addEventListener('click', searchCSV);
});
</script>
